import os
import json
from pathlib import Path
from typing import Dict, List, Any, Optional
import base64
from datetime import datetime
from src.llm import LLM

class ReportLLMGenerator:
    """LLMæŠ¥å‘Šç”Ÿæˆå™¨ï¼Œä½¿ç”¨å¤§æ¨¡å‹ç”ŸæˆHTMLæŠ¥å‘Š"""
    
    def __init__(self, model: str = "deepseek-v3", logger=None):
        """åˆå§‹åŒ–LLMæŠ¥å‘Šç”Ÿæˆå™¨
        
        Args:
            model: ä½¿ç”¨çš„LLMæ¨¡å‹
            logger: æ—¥å¿—è®°å½•å™¨å®ä¾‹(å¯é€‰)
        """
        self.llm = LLM(model=model)
        self.data_dir = None
        self.output_dir = "reports"
        self.report_name = "åˆ†ææŠ¥å‘Š"
        self.logger = logger
        
    def set_output_dir(self, output_dir: str):
        """è®¾ç½®è¾“å‡ºç›®å½•
        
        Args:
            output_dir: è¾“å‡ºç›®å½•è·¯å¾„
        """
        self.output_dir = output_dir
        os.makedirs(output_dir, exist_ok=True)
        
    def set_data_dir(self, data_dir: str):
        """è®¾ç½®æ•°æ®ç›®å½•ï¼Œç”¨äºè¯»å–JSONæ•°æ®
        
        Args:
            data_dir: æ•°æ®ç›®å½•è·¯å¾„
        """
        self.data_dir = data_dir
        
    def set_report_name(self, report_name: str):
        """è®¾ç½®æŠ¥å‘Šåç§°
        
        Args:
            report_name: æŠ¥å‘Šåç§°
        """
        self.report_name = report_name
    
    def load_json_data(self, filename: str) -> Dict:
        """åŠ è½½JSONæ•°æ®
        
        Args:
            filename: JSONæ–‡ä»¶å
            
        Returns:
            Dict: åŠ è½½çš„JSONæ•°æ®
        """
        try:
            file_path = os.path.join(self.data_dir, filename)
            if os.path.exists(file_path):
                with open(file_path, 'r', encoding='utf-8') as f:
                    return json.load(f)
            else:
                print(f"æ–‡ä»¶ä¸å­˜åœ¨: {file_path}")
                return {}
        except Exception as e:
            print(f"åŠ è½½JSONæ•°æ®å‡ºé”™: {str(e)}")
            return {}
    
    def load_all_data(self) -> Dict[str, Dict]:
        """åŠ è½½æ‰€æœ‰JSONæ•°æ®æ–‡ä»¶
        
        Returns:
            Dict[str, Dict]: æ‰€æœ‰JSONæ•°æ®çš„å­—å…¸
        """
        return {
            "brand_mentions": self.load_json_data("brand_mentions_analysis.json"),
            "brand_sentiment": self.load_json_data("brand_sentiment_analysis.json"),
            "competitor": self.load_json_data("competitor_analysis.json"),
            "feature": self.load_json_data("feature_analysis.json"),
            "keyword": self.load_json_data("keyword_analysis.json"),
            "trend": self.load_json_data("trend_analysis.json"),
            "ip_distribution": self.load_json_data("ip_distribution_analysis.json")
        }
    
    def generate_report(self, sub_reports: Optional[List[Dict]] = None, output_path: Optional[str] = None) -> str:
        """ç”Ÿæˆå®Œæ•´çš„HTMLæŠ¥å‘Š
        
        Args:
            sub_reports: å­æŠ¥å‘Šåˆ—è¡¨(ä¸ä½¿ç”¨)
            output_path: è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼Œå¦‚æœä¸ºNoneåˆ™è‡ªåŠ¨ç”Ÿæˆ
            
        Returns:
            str: ç”Ÿæˆçš„æŠ¥å‘Šè·¯å¾„
        """
        if output_path is None:
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            output_path = os.path.join(self.output_dir, f"report_{timestamp}.html")
        
        if self.logger:
            self.logger.log_custom(f"å¼€å§‹ç”Ÿæˆ {self.report_name}...")
        else:
            print(f"æ­£åœ¨ç”Ÿæˆ {self.report_name}...")
        
        # åŠ è½½æ‰€æœ‰æ•°æ®
        data = self.load_all_data()
        if not any(data.values()):
            if self.logger:
                self.logger.log_custom("æ— æ³•åŠ è½½æ•°æ®ï¼Œç”ŸæˆæŠ¥å‘Šå¤±è´¥")
            else:
                print("æ— æ³•åŠ è½½æ•°æ®ï¼Œç”ŸæˆæŠ¥å‘Šå¤±è´¥")
            return None
            
        # ç”ŸæˆæŠ¥å‘Šå„éƒ¨åˆ†å†…å®¹
        css_styles = self.get_css_styles()
        
        # å¼€å§‹ç”ŸæˆHTMLå†…å®¹
        with open(output_path, 'w', encoding='utf-8') as f:
            # å†™å…¥HTMLå¤´éƒ¨
            html_head = f"""
            <!DOCTYPE html>
            <html lang="zh-CN">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>{self.report_name}</title>
                <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
                <script src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
                <style>{css_styles}</style>
            </head>
            <body>
                <div class="report-container">
                    <div class="report-header">
                        <h1>{self.report_name}</h1>
                        <p class="report-date">ç”Ÿæˆæ—¥æœŸï¼š{datetime.now().strftime("%Yå¹´%mæœˆ%dæ—¥")}</p>
                    </div>
            """
            f.write(html_head)
            
            # ç”Ÿæˆå„ä¸ªæ¨¡å—
            for module_name, generator_func, module_data in [
                ("æ‰§è¡Œæ‘˜è¦", self.generate_executive_summary, data),
                ("å“ç‰Œå¯¹æ¯”åˆ†æ", self.generate_brand_comparison, data["brand_mentions"]),
                ("å“ç‰Œæƒ…æ„Ÿåˆ†æ", self.generate_brand_sentiment, data["brand_sentiment"]),
                ("è¡Œä¸šè¶‹åŠ¿åˆ†æ", self.generate_trend_analysis, data["trend"]),
                ("ç«äº‰åˆ†æ", self.generate_competitor_analysis, data["competitor"]),
                ("ç‰¹å¾åˆ†æ", self.generate_feature_analysis, data["feature"]),
                ("å…³é”®è¯åˆ†æ", self.generate_keyword_analysis, data["keyword"]),
                ("ç”¨æˆ·åœ°ç†åˆ†å¸ƒåˆ†æ", self.generate_ip_distribution_analysis, data["ip_distribution"]),
                ("ä¼˜åŒ–å»ºè®®", self.generate_optimization_suggestions, data)
            ]:
                if self.logger:
                    module_start = self.logger.log_step_start(f"ç”Ÿæˆ{module_name}")
                
                # è·å–ç”Ÿæˆå†…å®¹çš„è¿­ä»£å™¨
                content_iter = generator_func(module_data)
                
                # å¯¹äºéç”Ÿæˆå™¨å‡½æ•°ï¼Œç›´æ¥å†™å…¥å†…å®¹
                if not hasattr(content_iter, '__iter__') or hasattr(content_iter, '__len__'):
                    f.write(content_iter)
                    
                    if self.logger:
                        self.logger.log_step_result(module_start, f"{module_name}ç”Ÿæˆå®Œæˆ")
                    else:
                        print(f"{module_name}ç”Ÿæˆå®Œæˆ")
                    continue
                
                # å¤„ç†ç”Ÿæˆå™¨å‡½æ•°ï¼Œé€å—å†™å…¥å†…å®¹
                for chunk in content_iter:
                    f.write(chunk)
                    f.flush()  # ç¡®ä¿å†…å®¹ç«‹å³å†™å…¥æ–‡ä»¶
                
                if self.logger:
                    self.logger.log_step_result(module_start, f"{module_name}ç”Ÿæˆå®Œæˆ")
                else:
                    print(f"{module_name}ç”Ÿæˆå®Œæˆ")
            
            # å†™å…¥HTMLå°¾éƒ¨
            html_footer = """
                    <div class="report-footer">
                        <p>Â© """ + str(datetime.now().year) + """ Cotex AI | æ•°æ®åˆ†ææŠ¥å‘Š</p>
                    </div>
                </div>
                
                <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const chartContainers = document.querySelectorAll('[data-chart]');
                    chartContainers.forEach(container => {
                        const chartId = container.getAttribute('id');
                        const chartConfig = container.getAttribute('data-chart');
                        if (chartConfig && chartId) {
                            try {
                                const config = JSON.parse(chartConfig);
                                const chart = echarts.init(document.getElementById(chartId));
                                chart.setOption(config);
                                window.addEventListener('resize', function() {
                                    chart.resize();
                                });
                            } catch (e) {
                                console.error('åˆå§‹åŒ–å›¾è¡¨å‡ºé”™:', e);
                            }
                        }
                    });
                });
                </script>
            </body>
            </html>
            """
            f.write(html_footer)
        
        if self.logger:
            self.logger.log_custom(f"æŠ¥å‘Šå·²ç”Ÿæˆ: {output_path}")
            self.logger.log_file_output(output_path)
        else:
            print(f"æŠ¥å‘Šå·²ç”Ÿæˆ: {output_path}")
            
        return output_path
    
    def generate_report_stream(self, output_path: Optional[str] = None):
        """ç”Ÿæˆå®Œæ•´çš„HTMLæŠ¥å‘Šï¼ˆæµå¼è¾“å‡ºç‰ˆï¼‰
        
        Args:
            output_path: è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼Œå¦‚æœä¸ºNoneåˆ™è‡ªåŠ¨ç”Ÿæˆ
            
        Yields:
            str: ç”Ÿæˆçš„æŠ¥å‘Šç‰‡æ®µ
        """
        if output_path is None:
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            output_path = os.path.join(self.output_dir, f"report_{timestamp}.html")
        
        # ç”ŸæˆHTMLå¤´éƒ¨
        css_styles = self.get_css_styles()
        html_head = f"""<!DOCTYPE html>
        <html lang="zh-CN">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>{self.report_name}</title>
            <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
            <style>{css_styles}</style>
        </head>
        <body>
            <div class="report-container">
                <div class="report-header">
                    <h1>{self.report_name}</h1>
                    <p class="report-date">ç”Ÿæˆæ—¥æœŸï¼š{datetime.now().strftime("%Yå¹´%mæœˆ%dæ—¥")}</p>
                </div>"""
        
        yield html_head
        full_html = html_head
        
        # ç”Ÿæˆå„ä¸ªæ¨¡å—
        data = self.load_all_data()
        
        for module_name, generator_func, module_data in [
            ("æ‰§è¡Œæ‘˜è¦", self.generate_executive_summary, data),
            ("å“ç‰Œå¯¹æ¯”åˆ†æ", self.generate_brand_comparison, data["brand_mentions"]),
            ("å“ç‰Œæƒ…æ„Ÿåˆ†æ", self.generate_brand_sentiment, data["brand_sentiment"]),
            ("è¡Œä¸šè¶‹åŠ¿åˆ†æ", self.generate_trend_analysis, data["trend"]),
            ("ç«äº‰åˆ†æ", self.generate_competitor_analysis, data["competitor"]),
            ("ç‰¹å¾åˆ†æ", self.generate_feature_analysis, data["feature"]),
            ("å…³é”®è¯åˆ†æ", self.generate_keyword_analysis, data["keyword"]),
            ("ç”¨æˆ·åœ°ç†åˆ†å¸ƒåˆ†æ", self.generate_ip_distribution_analysis, data["ip_distribution"]),
            ("ä¼˜åŒ–å»ºè®®", self.generate_optimization_suggestions, data)
        ]:
            print(f"ç”Ÿæˆ{module_name}...")
            module_content = generator_func(module_data)
            yield module_content
            full_html += module_content
        
        # HTMLå°¾éƒ¨
        html_footer = """
                <div class="report-footer">
                    <p>Â© """ + str(datetime.now().year) + """ Cotex AI | æ•°æ®åˆ†ææŠ¥å‘Š</p>
                </div>
            </div>
            
            <script>
            document.addEventListener('DOMContentLoaded', function() {
                const chartContainers = document.querySelectorAll('[data-chart]');
                chartContainers.forEach(container => {
                    const chartId = container.getAttribute('id');
                    const chartConfig = container.getAttribute('data-chart');
                    if (chartConfig && chartId) {
                        try {
                            const config = JSON.parse(chartConfig);
                            const chart = echarts.init(document.getElementById(chartId));
                            chart.setOption(config);
                            window.addEventListener('resize', function() {
                                chart.resize();
                            });
                        } catch (e) {
                            console.error('åˆå§‹åŒ–å›¾è¡¨å‡ºé”™:', e);
                        }
                    }
                });
            });
            </script>
        </body>
        </html>"""
        
        yield html_footer
        full_html += html_footer
        
        # å†™å…¥æ–‡ä»¶
        with open(output_path, 'w', encoding='utf-8') as f:
            f.write(full_html)
        
        print(f"æŠ¥å‘Šå·²ç”Ÿæˆ: {output_path}")
    
    def _generate_with_stream(self, prompt: str):
        """è¾…åŠ©æ–¹æ³•ï¼šæ ¹æ®å½“å‰æµå¼çŠ¶æ€ç”Ÿæˆå†…å®¹
        
        Args:
            prompt: æç¤ºè¯
            
        Returns:
            stræˆ–ç”Ÿæˆå™¨: æ ¹æ®æµå¼çŠ¶æ€è¿”å›å­—ç¬¦ä¸²æˆ–å†…å®¹ç”Ÿæˆå™¨
        """
        # åœ¨æç¤ºè¯æœ«å°¾æ·»åŠ ä¸è¦ä½¿ç”¨Markdownæ ¼å¼çš„æŒ‡ç¤º
        prompt += """

é‡è¦ï¼šç›´æ¥è¿”å›åŸå§‹HTMLä»£ç ï¼Œä¸è¦ä½¿ç”¨Markdownæ ¼å¼ï¼ˆå¦‚```htmlï¼‰ï¼Œä¸è¦ä½¿ç”¨ä»»ä½•ä»£ç å—æ ‡è®°ã€‚
"""
        
        # å°† prompt åŒ…è£…æˆæ­£ç¡®çš„ messages æ ¼å¼
        llm_messages = [{"role": "user", "content": prompt}]

        # å¤„ç†æµå¼ç”Ÿæˆè¯·æ±‚
        try:
            # ç›´æ¥ä½¿ç”¨éæµå¼æ¨¡å¼ï¼Œæ–°ç‰ˆAPIä¸æ”¯æŒç›´æ¥è®¾ç½®streamå±æ€§
            # ä¼ é€’åŒ…è£…å¥½çš„ llm_messages åˆ—è¡¨ç»™ messages å‚æ•°
            return self.llm.generate(messages=llm_messages)
        except Exception as e:
            if self.logger:
                self.logger.log_error(f"ç”Ÿæˆå†…å®¹å¤±è´¥: {str(e)}")
            else:
                print(f"ç”Ÿæˆå†…å®¹å¤±è´¥: {str(e)}")
            return f"<div class='error'>ç”Ÿæˆå†…å®¹å¤±è´¥: {str(e)}</div>"
    
    def _clean_stream_content(self, content_stream):
        """å¤„ç†æµå¼ç”Ÿæˆå†…å®¹
        
        Args:
            content_stream: å†…å®¹ç”Ÿæˆå™¨
            
        Yields:
            str: å¤„ç†åçš„å†…å®¹ç‰‡æ®µ
        """
        try:
            for chunk in content_stream:
                delta = chunk.choices[0].delta if hasattr(chunk, 'choices') and chunk.choices else None
                content = delta.content if delta and hasattr(delta, 'content') else ""
                if content:
                    yield content
        except Exception as e:
            if self.logger:
                self.logger.log_error(f"æµå¼å¤„ç†å¤±è´¥: {str(e)}")
            else:
                print(f"æµå¼å¤„ç†å¤±è´¥: {str(e)}")
            yield f"<div class='error'>æµå¼å¤„ç†å¤±è´¥: {str(e)}</div>"
    
    def generate_executive_summary(self, all_data: Dict[str, Dict]) -> str:
        """ç”Ÿæˆæ‰§è¡Œæ‘˜è¦æ¨¡å—
        
        Args:
            all_data: æ‰€æœ‰æ•°æ®
            
        Returns:
            str: æ‰§è¡Œæ‘˜è¦HTMLå†…å®¹
        """
        prompt = f"""
        è¯·æ ¹æ®ä»¥ä¸‹æ•°æ®ï¼Œç”Ÿæˆåˆ†ææŠ¥å‘Šçš„æ‰§è¡Œæ‘˜è¦æ¨¡å—HTMLå†…å®¹ï¼š
        
        æŠ¥å‘Šåç§°ï¼š{self.report_name}
        
        æ•°æ®æ¦‚è§ˆï¼š
        {json.dumps(all_data, ensure_ascii=False, indent=2)}
        
        è¯·éµå¾ªä»¥ä¸‹è®¾è®¡è§„èŒƒï¼š
        1. æ¨¡å—å¸ƒå±€:
        ```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ æ‰§è¡Œæ‘˜è¦                                              ğŸ“‹ â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                                         â”‚
        â”‚ ã€æŠ¥å‘Šåã€‘åœ¨è¿‡å»ã€æ—¶é—´æ®µã€‘è·å¾—ã€Nã€‘æ¡ç›¸å…³æåŠï¼Œæ­£é¢è¯„ä»·  â”‚
        â”‚ å æ¯”ã€X%ã€‘ï¼Œè´Ÿé¢è¯„ä»·å æ¯”ã€Y%ã€‘ï¼›ç”¨æˆ·æœ€å…³æ³¨ã€ç‰¹å¾ã€‘ï¼Œ     â”‚
        â”‚ ä¸»è¦ç«äº‰å¯¹æ‰‹ä¸ºã€ç«å“åã€‘ã€‚                              â”‚
        â”‚                                                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        ```
        
        2. æ ·å¼è¦æ±‚:
        - ä½¿ç”¨åœ†è§’å¡ç‰‡æ ·å¼
        - æ ‡é¢˜ä½¿ç”¨18pxåŠ ç²—å­—ä½“
        - å†…å®¹ä½¿ç”¨14pxå¸¸è§„å­—ä½“
        - ä½¿ç”¨é€‚å½“çš„å†…è¾¹è·å’Œé—´è·
        
        3. å†…å®¹è¦æ±‚:
        - ç®€æ´æ˜äº†åœ°æ€»ç»“æŠ¥å‘Šåœ¨å¸‚åœºä¸­çš„è¡¨ç°
        - æä¾›å…³é”®æ•°æ®ç‚¹å’Œæ ¸å¿ƒå‘ç°
        - å†…å®¹åº”åŸºäºæä¾›çš„æ•°æ®ï¼Œä¸è¦ç¼–é€ æ•°æ®
        - å†…å®¹åº”å½“åŒ…å«æŠ¥å‘Šå£°é‡ã€æƒ…æ„Ÿåˆ†æã€å…³é”®ç‰¹å¾å’Œä¸»è¦ç«äº‰å¯¹æ‰‹ç­‰ä¿¡æ¯
        
        è¯·ç”Ÿæˆå®Œæ•´çš„HTMLä»£ç ç‰‡æ®µï¼Œä¸è¦åŒ…å«<html>ã€<head>æˆ–<body>æ ‡ç­¾ã€‚
        """
        
        return self._generate_with_stream(prompt)
    
    def generate_brand_comparison(self, brand_mentions_data: Dict) -> str:
        """ç”Ÿæˆå“ç‰Œå¯¹æ¯”åˆ†ææ¨¡å—
        
        Args:
            brand_mentions_data: å“ç‰ŒæåŠåˆ†ææ•°æ®
            
        Returns:
            str: å“ç‰Œå¯¹æ¯”åˆ†æHTMLå†…å®¹
        """
        prompt = f"""
        è¯·æ ¹æ®ä»¥ä¸‹æ•°æ®ï¼Œç”Ÿæˆå“ç‰Œå¯¹æ¯”åˆ†ææ¨¡å—çš„HTMLå†…å®¹ï¼š
        
        ```json
        {json.dumps(brand_mentions_data, ensure_ascii=False, indent=2)}
        ```
        
        è¯·éµå¾ªä»¥ä¸‹è®¾è®¡è§„èŒƒï¼š
        1. æ¨¡å—å¸ƒå±€:
        ```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ å“ç‰Œå¯¹æ¯”åˆ†æ                         ğŸ”„ åˆ‡æ¢æŒ‡æ ‡ ğŸ“Š TOP10 â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                                         â”‚
        â”‚ ã€æ ¸å¿ƒæ´å¯Ÿã€‘ã€å“ç‰Œåã€‘åœ¨æ‰€æœ‰è¯„è®ºå’Œå†…å®¹ä¸­è®¨è®ºçƒ­åº¦æœ€é«˜ï¼Œ   â”‚
        â”‚ å æ¯”è¾¾ã€X%ã€‘ï¼Œé¢†å…ˆç¬¬äºŒåå“ç‰Œã€Y%ã€‘                      â”‚
        â”‚                                                         â”‚
        â”‚ â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®  â”‚
        â”‚ â”‚                                                   â”‚  â”‚
        â”‚ â”‚              [å“ç‰Œå¯¹æ¯”æŸ±çŠ¶å›¾/æ°”æ³¡å›¾]              â”‚  â”‚
        â”‚ â”‚                                                   â”‚  â”‚
        â”‚ â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯  â”‚
        â”‚                                                         â”‚
        â”‚ ã€æ•°æ®æ˜ç»†ã€‘                                            â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ å“ç‰Œ     â”‚ å£°é‡   â”‚ æ­£é¢ç‡  â”‚ çƒ­åº¦æŒ‡æ•° â”‚ ç¯æ¯”å¢é•¿  â”‚
        â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
        â”‚ â”‚ å“ç‰ŒA    â”‚ XXX    â”‚ XX%     â”‚ XX       â”‚ â†‘XX%      â”‚
        â”‚ â”‚ å“ç‰ŒB    â”‚ XXX    â”‚ XX%     â”‚ XX       â”‚ â†“XX%      â”‚
        â”‚ â”‚ å“ç‰ŒC    â”‚ XXX    â”‚ XX%     â”‚ XX       â”‚ â†‘XX%      â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                                         â”‚
        â”‚ ã€ç”¨æˆ·åŸå£°ã€‘                                            â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ "ã€åŸæ–‡å¼•ç”¨1ã€‘" - æ¥è‡ªã€å¹³å°ã€‘                       â”‚ â”‚
        â”‚ â”‚ ğŸ‘ XXk Â· ğŸ”— ç‚¹å‡»æŸ¥çœ‹åŸæ–‡                              â”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ "ã€åŸæ–‡å¼•ç”¨2ã€‘" - æ¥è‡ªã€å¹³å°ã€‘                       â”‚ â”‚
        â”‚ â”‚ ğŸ‘ XXk Â· ğŸ”— ç‚¹å‡»æŸ¥çœ‹åŸæ–‡                              â”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        ```
        
        2. å¯è§†åŒ–è¦æ±‚:
        - ä½¿ç”¨ECharts.jsåˆ›å»ºå“ç‰Œå¯¹æ¯”æŸ±çŠ¶å›¾
        - å›¾è¡¨åº”æ˜¾ç¤ºTOPå“ç‰Œçš„è®¨è®ºçƒ­åº¦å æ¯”
        - ç¡®ä¿å›¾è¡¨äº¤äº’æ€§(æ‚¬åœæ˜¾ç¤ºè¯¦æƒ…)
        - ä½¿ç”¨#3366FFä½œä¸ºä¸»è‰²è°ƒï¼Œè¾…åŠ©è‰²ä¸º#FF6633å’Œ#EFEFEF
        
        3. å†…å®¹è¦æ±‚:
        - æ ¸å¿ƒæ´å¯Ÿéƒ¨åˆ†éœ€è¦æç‚¼æ•°æ®ä¸­æœ€é‡è¦çš„å‘ç°
        - æ•°æ®æ˜ç»†è¡¨æ ¼åº”å±•ç¤ºä¸»è¦å“ç‰Œçš„å…³é”®æŒ‡æ ‡
        - ç”¨æˆ·åŸå£°éƒ¨åˆ†åº”å±•ç¤º3-5æ¡çœŸå®çš„ç”¨æˆ·è¯„è®º
        - ç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½æ¥è‡ªæä¾›çš„JSON
        
        è¯·ç”Ÿæˆå®Œæ•´çš„HTMLä»£ç ç‰‡æ®µï¼ŒåŒ…å«å¿…è¦çš„CSSæ ·å¼å’ŒECharts.jsçš„å›¾è¡¨é…ç½®ã€‚ä¸è¦åŒ…å«<html>ã€<head>æˆ–<body>æ ‡ç­¾ã€‚
        """
        
        return self._generate_with_stream(prompt)
    
    def generate_brand_sentiment(self, brand_sentiment_data: Dict) -> str:
        """ç”Ÿæˆå“ç‰Œæƒ…æ„Ÿåˆ†ææ¨¡å—
        
        Args:
            brand_sentiment_data: å“ç‰Œæƒ…æ„Ÿåˆ†ææ•°æ®
            
        Returns:
            str: å“ç‰Œæƒ…æ„Ÿåˆ†æHTMLå†…å®¹
        """
        prompt = f"""
        è¯·æ ¹æ®ä»¥ä¸‹æ•°æ®ï¼Œç”Ÿæˆå“ç‰Œæƒ…æ„Ÿåˆ†ææ¨¡å—çš„HTMLå†…å®¹ï¼š
        
        ```json
        {json.dumps(brand_sentiment_data, ensure_ascii=False, indent=2)}
        ```
        
        è¯·éµå¾ªä»¥ä¸‹è®¾è®¡è§„èŒƒï¼š
        1. æ¨¡å—å¸ƒå±€:
        ```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ å“ç‰Œæƒ…æ„Ÿåˆ†æ                                   ğŸ”„ å¹³å°ç­›é€‰ â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                                         â”‚
        â”‚ ã€æ ¸å¿ƒæ´å¯Ÿã€‘ã€å“ç‰Œåã€‘è·å¾—äº†ã€X%ã€‘çš„æ­£é¢è¯„ä»·ï¼Œä¸»è¦é›†ä¸­åœ¨ â”‚
        â”‚ ã€æŸé¢†åŸŸã€‘æ–¹é¢                                          â”‚
        â”‚                                                         â”‚
        â”‚ â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® â”‚
        â”‚ â”‚                               â”‚ â”‚                  â”‚ â”‚
        â”‚ â”‚      [å †å æŸ±çŠ¶å›¾/é¥¼å›¾]         â”‚ â”‚   [æƒ…æ„Ÿé›·è¾¾å›¾]   â”‚ â”‚
        â”‚ â”‚                               â”‚ â”‚                  â”‚ â”‚
        â”‚ â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯ â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯ â”‚
        â”‚                                                         â”‚
        â”‚                                                         â”‚
        â”‚ ã€ç”¨æˆ·åŸå£°ã€‘                                            â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ ğŸ˜€ "ã€æ­£é¢è¯„ä»·åŸå£°1ã€‘" - æ¥è‡ªã€å¹³å°ã€‘                 â”‚ â”‚
        â”‚ â”‚ ğŸ‘ XXk Â· ğŸ’¬ XXæ¡å›å¤                                  â”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        ```
        
        2. å¯è§†åŒ–è¦æ±‚:
        - ä½¿ç”¨ECharts.jsåˆ›å»ºæƒ…æ„Ÿåˆ†æé¥¼å›¾
        - ä½¿ç”¨åˆé€‚çš„é¢œè‰²æ ‡è¯†æ­£é¢/è´Ÿé¢/ä¸­æ€§æƒ…æ„Ÿ
        - ç¡®ä¿å›¾è¡¨äº¤äº’æ€§(æ‚¬åœæ˜¾ç¤ºè¯¦æƒ…)
        
        3. å†…å®¹è¦æ±‚:
        - æ ¸å¿ƒæ´å¯Ÿéƒ¨åˆ†éœ€è¦æç‚¼æ•°æ®ä¸­æœ€é‡è¦çš„æƒ…æ„Ÿåˆ†æå‘ç°
        - ç”¨æˆ·åŸå£°éƒ¨åˆ†åº”åˆ†åˆ«å±•ç¤ºæ­£é¢å’Œè´Ÿé¢è¯„ä»·çš„çœŸå®ç”¨æˆ·è¯„è®º
        - å¦‚æœæ•°æ®ç¼ºå¤±ï¼Œè¯·ä¼˜é›…åœ°å¤„ç†å¹¶æ˜¾ç¤º"æš‚æ— æ•°æ®"
        - ç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½æ¥è‡ªæä¾›çš„JSON
                
        è¯·ç”Ÿæˆå®Œæ•´çš„HTMLä»£ç ç‰‡æ®µï¼ŒåŒ…å«å¿…è¦çš„CSSæ ·å¼å’ŒECharts.jsçš„å›¾è¡¨é…ç½®ã€‚ä¸è¦åŒ…å«<html>ã€<head>æˆ–<body>æ ‡ç­¾ã€‚
        """
        
        return self._generate_with_stream(prompt)
    
    def generate_trend_analysis(self, trend_data: Dict) -> str:
        """ç”Ÿæˆè¶‹åŠ¿åˆ†ææ¨¡å—
        
        Args:
            trend_data: è¶‹åŠ¿åˆ†ææ•°æ®
            
        Returns:
            str: è¶‹åŠ¿åˆ†æHTMLå†…å®¹
        """
        prompt = f"""
        è¯·æ ¹æ®ä»¥ä¸‹æ•°æ®ï¼Œç”Ÿæˆè¡Œä¸šè¶‹åŠ¿åˆ†ææ¨¡å—çš„HTMLå†…å®¹ï¼š
        
        ```json
        {json.dumps(trend_data, ensure_ascii=False, indent=2)}
        ```
        
        è¯·éµå¾ªä»¥ä¸‹è®¾è®¡è§„èŒƒï¼š
        1. æ¨¡å—å¸ƒå±€:
        ```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ è¡Œä¸šè¶‹åŠ¿åˆ†æ                         ğŸ”„ åˆ‡æ¢æ—¶é—´ ğŸ“Š çƒ­ç‚¹æ¦œ â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                                         â”‚
        â”‚ ã€æ ¸å¿ƒæ´å¯Ÿã€‘å½“å‰è¡Œä¸šæœ€çƒ­é—¨çš„è®¨è®ºä¸»é¢˜æ˜¯ã€è¯é¢˜åç§°ã€‘ï¼Œ     â”‚
        â”‚ çƒ­åº¦å€¼è¾¾åˆ°ã€æ•°å€¼ã€‘ï¼Œä¸»è¦æ¶‰åŠã€å“ç‰Œåˆ—è¡¨ã€‘                â”‚
        â”‚                                                         â”‚
        â”‚ â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®  â”‚
        â”‚ â”‚                                                   â”‚  â”‚
        â”‚ â”‚              [çƒ­åº¦è¶‹åŠ¿å›¾/çƒ­ç‚¹æ¦œ]                  â”‚  â”‚
        â”‚ â”‚                                                   â”‚  â”‚
        â”‚ â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯  â”‚
        â”‚                                                         â”‚
        â”‚ ã€çƒ­ç‚¹è¯é¢˜TOP3ã€‘                                        â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ è¯é¢˜           â”‚ çƒ­åº¦å€¼ â”‚ å‘å¸ƒæ—¥æœŸ    â”‚ æ¶‰åŠå“ç‰Œ   â”‚
        â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
        â”‚ â”‚ ã€è¯é¢˜1ã€‘      â”‚ XXXXX  â”‚ YYYY-MM-DD  â”‚ A,B,C      â”‚
        â”‚ â”‚ ã€è¯é¢˜2ã€‘      â”‚ XXXXX  â”‚ YYYY-MM-DD  â”‚ B,D,E      â”‚
        â”‚ â”‚ ã€è¯é¢˜3ã€‘      â”‚ XXXXX  â”‚ YYYY-MM-DD  â”‚ A,C,F      â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                                         â”‚
        â”‚ ã€ç”¨æˆ·åŸå£°ã€‘                                            â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ "ã€åŸæ–‡å¼•ç”¨1ã€‘" - æ¥è‡ªã€å¹³å°ã€‘                       â”‚ â”‚
        â”‚ â”‚ ğŸ‘ XXk Â· ğŸ”¥ çƒ­åº¦å€¼: XXXXX                             â”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        ```
        
        2. å¯è§†åŒ–è¦æ±‚:
        - ä½¿ç”¨ECharts.jsåˆ›å»ºçƒ­åº¦æ¡å½¢å›¾
        - æ¨ªè½´ä¸ºè¯é¢˜åç§°ï¼Œçºµè½´ä¸ºçƒ­åº¦å€¼
        - ä½¿ç”¨æ¸å˜è‰²æ˜¾ç¤ºçƒ­åº¦å·®å¼‚
        - ç¡®ä¿å›¾è¡¨äº¤äº’æ€§(æ‚¬åœæ˜¾ç¤ºè¯¦æƒ…)
        
        3. å†…å®¹è¦æ±‚:
        - æ ¸å¿ƒæ´å¯Ÿéƒ¨åˆ†éœ€è¦æç‚¼æ•°æ®ä¸­æœ€é‡è¦çš„è¶‹åŠ¿å‘ç°
        - çƒ­ç‚¹è¯é¢˜è¡¨æ ¼åº”å±•ç¤ºTOP3çƒ­é—¨è¯é¢˜çš„è¯¦ç»†ä¿¡æ¯
        - ç”¨æˆ·åŸå£°éƒ¨åˆ†åº”å±•ç¤ºä¸çƒ­é—¨è¯é¢˜ç›¸å…³çš„çœŸå®ç”¨æˆ·è¯„è®º
        - ç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½æ¥è‡ªæä¾›çš„JSON
        
        è¯·ç”Ÿæˆå®Œæ•´çš„HTMLä»£ç ç‰‡æ®µï¼ŒåŒ…å«å¿…è¦çš„CSSæ ·å¼å’ŒECharts.jsçš„å›¾è¡¨é…ç½®ã€‚ä¸è¦åŒ…å«<html>ã€<head>æˆ–<body>æ ‡ç­¾ã€‚
        """
        
        return self._generate_with_stream(prompt)
    
    def generate_competitor_analysis(self, competitor_data: Dict) -> str:
        """ç”Ÿæˆç«äº‰å“ç‰Œåˆ†ææ¨¡å—
        
        Args:
            competitor_data: ç«äº‰å“ç‰Œåˆ†ææ•°æ®
            
        Returns:
            str: ç«äº‰å“ç‰Œåˆ†æHTMLå†…å®¹
        """
        prompt = f"""
        è¯·æ ¹æ®ä»¥ä¸‹æ•°æ®ï¼Œç”Ÿæˆç«äº‰å“ç‰Œåˆ†ææ¨¡å—çš„HTMLå†…å®¹ï¼š
        
        ```json
        {json.dumps(competitor_data, ensure_ascii=False, indent=2)}
        ```
        
        è¯·éµå¾ªä»¥ä¸‹è®¾è®¡è§„èŒƒï¼š
        1. æ¨¡å—å¸ƒå±€:
        ```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ç«äº‰å“ç‰Œåˆ†æ                                     ğŸ“Š TOP5 â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                                         â”‚
        â”‚ ã€æ ¸å¿ƒæ´å¯Ÿã€‘ã€å“ç‰Œåã€‘çš„ä¸»è¦ç«äº‰å¯¹æ‰‹æ˜¯ã€ç«å“åã€‘ï¼Œä¸¤è€…åœ¨ â”‚
        â”‚ ã€é¢†åŸŸã€‘æ–¹é¢å­˜åœ¨ç›´æ¥ç«äº‰                               â”‚
        â”‚                                                         â”‚
        â”‚ â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® â”‚
        â”‚ â”‚                               â”‚ â”‚                  â”‚ â”‚
        â”‚ â”‚    [ç«äº‰å…³ç³»ç½‘ç»œå›¾]           â”‚ â”‚ [ç”¨æˆ·æµå¤±è¶‹åŠ¿å›¾] â”‚ â”‚
        â”‚ â”‚                               â”‚ â”‚                  â”‚ â”‚
        â”‚ â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯ â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯ â”‚
        â”‚                                                         â”‚
        â”‚ ã€ç«äº‰å“ç‰ŒTOP5ã€‘                                         â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ å“ç‰Œ     â”‚ æåŠç‡  â”‚ ç”¨æˆ·æµå¤±ç‡ â”‚ ç”¨æˆ·æ‘‡æ‘†ç‡ â”‚ ç«äº‰åº¦ â”‚ â”‚
        â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
        â”‚ â”‚ ã€ç«å“1ã€‘ â”‚ XX%     â”‚ XX%       â”‚ XX%      â”‚ â˜…â˜…â˜…â˜…â˜… â”‚ â”‚
        â”‚ â”‚ ã€ç«å“2ã€‘ â”‚ XX%     â”‚ XX%       â”‚ XX%      â”‚ â˜…â˜…â˜…â˜…â˜† â”‚ â”‚
        â”‚ â”‚ ã€ç«å“3ã€‘ â”‚ XX%     â”‚ XX%       â”‚ XX%      â”‚ â˜…â˜…â˜…â˜†â˜† â”‚ â”‚
        â”‚ â”‚ ã€ç«å“4ã€‘ â”‚ XX%     â”‚ XX%       â”‚ XX%      â”‚ â˜…â˜…â˜†â˜†â˜† â”‚ â”‚
        â”‚ â”‚ ã€ç«å“5ã€‘ â”‚ XX%     â”‚ XX%       â”‚ XX%      â”‚ â˜…â˜†â˜†â˜†â˜† â”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                                         â”‚
        â”‚ ã€ç”¨æˆ·åŸå£°ã€‘                                            â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ "ã€åŸæ–‡å¼•ç”¨1ã€‘" - æ¥è‡ªã€å¹³å°ã€‘                       â”‚ â”‚
        â”‚ â”‚ ğŸ‘ XXk Â· æ¶‰åŠå“ç‰Œ: æœ¬å“ç‰Œ vs ã€ç«å“ã€‘                 â”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        ```
        
        2. å¯è§†åŒ–è¦æ±‚:
        - ä½¿ç”¨ECharts.jsåˆ›å»ºç½‘ç»œå…³ç³»å›¾ï¼Œæ˜¾ç¤ºå“ç‰Œé—´çš„ç«äº‰å…³ç³»
        - èŠ‚ç‚¹å¤§å°è¡¨ç¤ºå“ç‰ŒæåŠç‡
        - è¿çº¿ç²—ç»†è¡¨ç¤ºç«äº‰å¼ºåº¦
        - ç¡®ä¿å›¾è¡¨äº¤äº’æ€§(æ‚¬åœæ˜¾ç¤ºè¯¦æƒ…)
        
        3. å†…å®¹è¦æ±‚:
        - æ ¸å¿ƒæ´å¯Ÿéƒ¨åˆ†éœ€è¦æç‚¼æ•°æ®ä¸­æœ€é‡è¦çš„ç«äº‰å…³ç³»å‘ç°
        - ç«äº‰å“ç‰Œè¡¨æ ¼åº”å±•ç¤ºTOP5ç«äº‰å“ç‰Œçš„å…³é”®æŒ‡æ ‡
        - ç”¨æˆ·åŸå£°éƒ¨åˆ†åº”å±•ç¤ºæåŠå¤šä¸ªå“ç‰Œçš„çœŸå®ç”¨æˆ·è¯„è®º
        - ç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½æ¥è‡ªæä¾›çš„JSON
        
        è¯·ç”Ÿæˆå®Œæ•´çš„HTMLä»£ç ç‰‡æ®µï¼ŒåŒ…å«å¿…è¦çš„CSSæ ·å¼å’ŒECharts.jsçš„å›¾è¡¨é…ç½®ã€‚ä¸è¦åŒ…å«<html>ã€<head>æˆ–<body>æ ‡ç­¾ã€‚
        """
        
        return self._generate_with_stream(prompt)
    
    def generate_feature_analysis(self, feature_data: Dict) -> str:
        """ç”Ÿæˆäº§å“ç‰¹å¾åˆ†ææ¨¡å—
        
        Args:
            feature_data: äº§å“ç‰¹å¾åˆ†ææ•°æ®
            
        Returns:
            str: äº§å“ç‰¹å¾åˆ†æHTMLå†…å®¹
        """
        prompt = f"""
        è¯·æ ¹æ®ä»¥ä¸‹æ•°æ®ï¼Œç”Ÿæˆäº§å“ç‰¹å¾åˆ†ææ¨¡å—çš„HTMLå†…å®¹ï¼š
        
        ```json
        {json.dumps(feature_data, ensure_ascii=False, indent=2)}
        ```
        
        è¯·éµå¾ªä»¥ä¸‹è®¾è®¡è§„èŒƒï¼š
        1. æ¨¡å—å¸ƒå±€:
        ```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ äº§å“ç‰¹å¾åˆ†æ                            ğŸ”„ åˆ‡æ¢å“ç‰Œ ğŸ” è¯¦æƒ… â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                                         â”‚
        â”‚ ã€æ ¸å¿ƒæ´å¯Ÿã€‘ç”¨æˆ·æœ€å…³æ³¨çš„äº§å“ç‰¹å¾æ˜¯ã€Œã€ç‰¹å¾åã€‘ã€ï¼Œ       â”‚
        â”‚ å…¶ä¸­ã€å“ç‰Œåã€‘åœ¨è¯¥ç»´åº¦å¾—åˆ†ã€Xã€‘åˆ†ï¼Œè¡¨ç°æœ€ä½³              â”‚
        â”‚                                                         â”‚
        â”‚ â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®  â”‚
        â”‚ â”‚                                                   â”‚  â”‚
        â”‚ â”‚                 [å¤šç»´åº¦é›·è¾¾å›¾]                    â”‚  â”‚
        â”‚ â”‚                                                   â”‚  â”‚
        â”‚ â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯  â”‚
        â”‚                                                         â”‚
        â”‚ ã€ç‰¹å¾å¯¹æ¯”æ˜ç»†ã€‘                                        â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚ â”‚ ç‰¹å¾      â”‚ å“ç‰ŒA   â”‚ å“ç‰ŒB   â”‚ å“ç‰ŒC   â”‚ å“ç‰ŒD   â”‚  â”‚
        â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
        â”‚ â”‚ å¤–è§‚è®¾è®¡  â”‚ â˜…â˜…â˜…â˜…â˜…  â”‚ â˜…â˜…â˜…â˜…â˜†  â”‚ â˜…â˜…â˜…â˜†â˜†  â”‚ â˜…â˜…â˜…â˜…â˜†  â”‚  â”‚
        â”‚ â”‚ æ€§èƒ½è¡¨ç°  â”‚ â˜…â˜…â˜…â˜…â˜†  â”‚ â˜…â˜…â˜…â˜…â˜…  â”‚ â˜…â˜…â˜…â˜…â˜†  â”‚ â˜…â˜…â˜…â˜†â˜†  â”‚  â”‚
        â”‚ â”‚ ä»·æ ¼æ€§ä»·æ¯”â”‚ â˜…â˜…â˜…â˜†â˜†  â”‚ â˜…â˜…â˜…â˜…â˜†  â”‚ â˜…â˜…â˜…â˜…â˜…  â”‚ â˜…â˜…â˜…â˜†â˜†  â”‚  â”‚
        â”‚ â”‚ æ™ºèƒ½é©¾é©¶  â”‚ â˜…â˜…â˜…â˜…â˜†  â”‚ â˜…â˜…â˜…â˜†â˜†  â”‚ â˜…â˜…â˜…â˜…â˜†  â”‚ â˜…â˜…â˜…â˜…â˜…  â”‚  â”‚
        â”‚ â”‚ ç”¨æˆ·ä½“éªŒ  â”‚ â˜…â˜…â˜…â˜…â˜†  â”‚ â˜…â˜…â˜…â˜…â˜†  â”‚ â˜…â˜…â˜…â˜†â˜†  â”‚ â˜…â˜…â˜…â˜…â˜†  â”‚  â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                                                         â”‚
        â”‚ ã€ç”¨æˆ·åŸå£°ã€‘                                            â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ ğŸ” ã€ç‰¹å¾å1ã€‘: "ã€åŸæ–‡å¼•ç”¨1ã€‘" - æ¥è‡ªã€å¹³å°ã€‘        â”‚ â”‚
        â”‚ â”‚ ğŸ‘ XXk Â· å“ç‰Œ: ã€å“ç‰Œåã€‘                             â”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        ```
        
        2. å¯è§†åŒ–è¦æ±‚:
        - ä½¿ç”¨ECharts.jsåˆ›å»ºå¤šç»´åº¦é›·è¾¾å›¾
        - æ¯ä¸ªå“ç‰Œä½¿ç”¨ä¸åŒé¢œè‰²ï¼Œå½¢æˆæ˜æ˜¾åŒºåˆ†
        - ç»´åº¦åº”åŒ…æ‹¬æ‰€æœ‰äº§å“ç‰¹å¾
        - ç¡®ä¿å›¾è¡¨äº¤äº’æ€§(æ‚¬åœæ˜¾ç¤ºè¯¦æƒ…)
        
        3. å†…å®¹è¦æ±‚:
        - æ ¸å¿ƒæ´å¯Ÿéƒ¨åˆ†éœ€è¦æç‚¼æ•°æ®ä¸­æœ€é‡è¦çš„äº§å“ç‰¹å¾å‘ç°
        - ç‰¹å¾å¯¹æ¯”æ˜ç»†è¡¨æ ¼åº”å±•ç¤ºæ‰€æœ‰å“ç‰Œåœ¨å„ä¸ªç‰¹å¾ç»´åº¦ä¸Šçš„è¡¨ç°
        - ç”¨æˆ·åŸå£°éƒ¨åˆ†åº”æŒ‰ç‰¹å¾åˆ†ç±»å±•ç¤ºçœŸå®ç”¨æˆ·è¯„è®º
        - ç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½æ¥è‡ªæä¾›çš„JSON
        
        è¯·ç”Ÿæˆå®Œæ•´çš„HTMLä»£ç ç‰‡æ®µï¼ŒåŒ…å«å¿…è¦çš„CSSæ ·å¼å’ŒECharts.jsçš„å›¾è¡¨é…ç½®ã€‚ä¸è¦åŒ…å«<html>ã€<head>æˆ–<body>æ ‡ç­¾ã€‚
        """
        
        return self._generate_with_stream(prompt)
    
    def generate_keyword_analysis(self, keyword_data: Dict) -> str:
        """ç”Ÿæˆå…³é”®è¯åˆ†ææ¨¡å—
        
        Args:
            keyword_data: å…³é”®è¯åˆ†ææ•°æ®
            
        Returns:
            str: å…³é”®è¯åˆ†æHTMLå†…å®¹
        """
        prompt = """
        è¯·æ ¹æ®ä»¥ä¸‹æ•°æ®ï¼Œç”Ÿæˆå“ç‰Œå…³é”®è¯åˆ†ææ¨¡å—çš„HTMLå†…å®¹ï¼š
        
        ```json
        """ + json.dumps(keyword_data, ensure_ascii=False, indent=2) + """
        ```
        
        è¯·éµå¾ªä»¥ä¸‹è®¾è®¡è§„èŒƒï¼š
        1. æ¨¡å—å¸ƒå±€:
        ```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ å“ç‰Œå…³é”®è¯åˆ†æ                       ğŸ”„ åˆ‡æ¢å“ç‰Œ ğŸ” æƒ…æ„Ÿç­›é€‰ â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                                         â”‚
        â”‚ ã€æ ¸å¿ƒæ´å¯Ÿã€‘ã€å“ç‰Œåã€‘ç›¸å…³è®¨è®ºä¸­ï¼Œã€Œã€å…³é”®è¯ã€‘ã€æ˜¯æœ€çƒ­é—¨çš„â”‚
        â”‚ æ­£é¢å…³é”®è¯ï¼Œæƒé‡å€¼è¾¾åˆ°ã€æ•°å€¼ã€‘                          â”‚
        â”‚                                                         â”‚
        â”‚ â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® â”‚
        â”‚ â”‚                               â”‚ â”‚                  â”‚ â”‚
        â”‚ â”‚     [æ­£é¢å…³é”®è¯è¯äº‘]          â”‚ â”‚  [è´Ÿé¢å…³é”®è¯è¯äº‘]â”‚ â”‚
        â”‚ â”‚                               â”‚ â”‚                  â”‚ â”‚
        â”‚ â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯ â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯ â”‚
        â”‚                                                         â”‚
        â”‚ ã€çƒ­é—¨å…³é”®è¯TOP10ã€‘                                      â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ å…³é”®è¯      â”‚ æåŠæ•°   â”‚ æƒ…æ„Ÿå€¾å‘   â”‚ çƒ­åº¦å€¼  â”‚ è¶‹åŠ¿   â”‚
        â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
        â”‚ â”‚ ã€å…³é”®è¯1ã€‘  â”‚ XXX     â”‚ æ­£é¢       â”‚ XX     â”‚ â†‘XX%   â”‚
        â”‚ â”‚ ã€å…³é”®è¯2ã€‘  â”‚ XXX     â”‚ è´Ÿé¢       â”‚ XX     â”‚ â†“XX%   â”‚
        â”‚ â”‚ ...         â”‚ ...     â”‚ ...       â”‚ ...    â”‚ ...    â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                                         â”‚
        â”‚ ã€å…³é”®è¯å…³è”åŸå£°ã€‘                                      â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ å…³äº"ã€å…³é”®è¯ã€‘"çš„è®¨è®º:                               â”‚ â”‚
        â”‚ â”‚ "ã€åŸæ–‡å¼•ç”¨1ã€‘" - æ¥è‡ªã€å¹³å°ã€‘                       â”‚ â”‚
        â”‚ â”‚ ğŸ‘ XXk Â· ğŸ’¬ XXæ¡å›å¤                                  â”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        ```
        
        2. å¯è§†åŒ–è¦æ±‚:
           - ä½¿ç”¨echarts-wordcloudæ’ä»¶åˆ›å»ºè¯äº‘å›¾
           - æ­£é¢è¯äº‘ä½¿ç”¨è“è‰²ç³»(#1890ff)ï¼Œè´Ÿé¢è¯äº‘ä½¿ç”¨çº¢è‰²ç³»(#f5222d)
           - è¯çš„å¤§å°åº”ä¸æƒé‡æˆæ­£æ¯”
           - ç¡®ä¿å›¾è¡¨äº¤äº’æ€§(æ‚¬åœæ˜¾ç¤ºè¯¦æƒ…)
        
        3. å†…å®¹è¦æ±‚:
        - æ ¸å¿ƒæ´å¯Ÿéƒ¨åˆ†éœ€è¦æç‚¼æ•°æ®ä¸­æœ€é‡è¦çš„å…³é”®è¯å‘ç°
        - çƒ­é—¨å…³é”®è¯è¡¨æ ¼åº”å±•ç¤ºTOP10å…³é”®è¯çš„è¯¦ç»†ä¿¡æ¯
        - å…³é”®è¯å…³è”åŸå£°éƒ¨åˆ†åº”å±•ç¤ºä¸çƒ­é—¨å…³é”®è¯ç›¸å…³çš„çœŸå®ç”¨æˆ·è¯„è®º
        - ç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½æ¥è‡ªæä¾›çš„JSON
        
        é‡è¦æç¤ºï¼šä½¿ç”¨echarts-wordcloudæ’ä»¶åˆ›å»ºè¯äº‘ï¼Œç¡®ä¿åˆ›å»ºä¸¤ä¸ªç‹¬ç«‹çš„è¯äº‘å®¹å™¨ï¼Œåˆ†åˆ«ç”¨äºæ­£é¢å’Œè´Ÿé¢å…³é”®è¯ã€‚
        
        è¯·ç›´æ¥è¿”å›åŸå§‹HTMLä»£ç ï¼Œä¸è¦ä½¿ç”¨Markdownæ ¼å¼ï¼ˆå¦‚```htmlï¼‰ï¼Œä¸è¦ä½¿ç”¨ä»»ä½•ä»£ç å—æ ‡è®°ã€‚åªè¾“å‡ºHTMLä»£ç ï¼Œä¸è¦åŒ…å«<html>ã€<head>æˆ–<body>æ ‡ç­¾ã€‚
        """
        
        # å°† prompt åŒ…è£…æˆæ­£ç¡®çš„ messages æ ¼å¼
        llm_messages = [{"role": "user", "content": prompt}]
        # ä¼ é€’åŒ…è£…å¥½çš„ llm_messages åˆ—è¡¨ç»™ messages å‚æ•°
        return self.llm.generate(messages=llm_messages)
    
    def generate_optimization_suggestions(self, all_data: Dict[str, Any]) -> str:
        """ç”Ÿæˆå“ç‰Œä¼˜åŒ–å»ºè®®æ¨¡å—
        
        Args:
            all_data: æ‰€æœ‰æ•°æ®
            
        Returns:
            str: å“ç‰Œä¼˜åŒ–å»ºè®®HTMLå†…å®¹
        """
        prompt = """
        è¯·æ ¹æ®ä»¥ä¸‹æ•°æ®ï¼Œç”Ÿæˆå“ç‰Œä¼˜åŒ–å»ºè®®æ¨¡å—çš„HTMLå†…å®¹ï¼š
        
        ```json
        """ + json.dumps(all_data, ensure_ascii=False, indent=2) + """
        ```
        
        è¯·éµå¾ªä»¥ä¸‹è®¾è®¡è§„èŒƒï¼š
        1. æ¨¡å—å¸ƒå±€:
        ```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ å“ç‰Œä¼˜åŒ–å»ºè®®                                      ğŸŒŸ é‡è¦ â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                                         â”‚
        â”‚ åŸºäºæ•°æ®åˆ†æï¼Œæˆ‘ä»¬å»ºè®®ä¼˜åŒ–ä»¥ä¸‹å…³é”®é¢†åŸŸï¼š                 â”‚
        â”‚                                                         â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ ğŸ“ˆ ã€å»ºè®®é¢†åŸŸ1ã€‘                                     â”‚ â”‚
        â”‚ â”‚ â€¢ ã€å…·ä½“å»ºè®®å†…å®¹ã€‘                                   â”‚ â”‚
        â”‚ â”‚ â€¢ ã€å…·ä½“å»ºè®®å†…å®¹ã€‘                                   â”‚ â”‚
        â”‚ â”‚ ğŸ“Š æ•°æ®æ”¯æ’‘: ã€æ”¯æŒè¯¥å»ºè®®çš„å…·ä½“æ•°æ®ç‚¹ã€‘              â”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                                         â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ ğŸ”„ ã€å»ºè®®é¢†åŸŸ2ã€‘                                     â”‚ â”‚
        â”‚ â”‚ â€¢ ã€å…·ä½“å»ºè®®å†…å®¹ã€‘                                   â”‚ â”‚
        â”‚ â”‚ â€¢ ã€å…·ä½“å»ºè®®å†…å®¹ã€‘                                   â”‚ â”‚
        â”‚ â”‚ ğŸ“Š æ•°æ®æ”¯æ’‘: ã€æ”¯æŒè¯¥å»ºè®®çš„å…·ä½“æ•°æ®ç‚¹ã€‘              â”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                                         â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ ğŸ›¡ï¸ ã€å»ºè®®é¢†åŸŸ3ã€‘                                     â”‚ â”‚
        â”‚ â”‚ â€¢ ã€å…·ä½“å»ºè®®å†…å®¹ã€‘                                   â”‚ â”‚
        â”‚ â”‚ â€¢ ã€å…·ä½“å»ºè®®å†…å®¹ã€‘                                   â”‚ â”‚
        â”‚ â”‚ ğŸ“Š æ•°æ®æ”¯æ’‘: ã€æ”¯æŒè¯¥å»ºè®®çš„å…·ä½“æ•°æ®ç‚¹ã€‘              â”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        ```
        
        2. æ ·å¼è¦æ±‚:
        - ä½¿ç”¨çªå‡ºçš„å¡ç‰‡å¼è®¾è®¡
        - æ¯ä¸ªå»ºè®®å¡ç‰‡ä½¿ç”¨ä¸åŒçš„å›¾æ ‡
        - ä½¿ç”¨é†’ç›®çš„å›¾æ ‡æ ‡è®°é‡è¦å»ºè®®
        - ä¸ºä¸åŒç±»å‹çš„å»ºè®®ä½¿ç”¨ä¸åŒçš„è¾¹æ¡†é¢œè‰²
        
        3. å†…å®¹è¦æ±‚:
        - åŸºäºæ‰€æœ‰æ•°æ®åˆ†æç”Ÿæˆ3-5ä¸ªå…³é”®ä¼˜åŒ–å»ºè®®
        - æ¯ä¸ªå»ºè®®åº”æœ‰æ˜ç¡®çš„é¢†åŸŸæ ‡é¢˜
        - æ¯ä¸ªå»ºè®®åº”åŒ…å«2-3ä¸ªå…·ä½“çš„ä¼˜åŒ–å†…å®¹
        - æ¯ä¸ªå»ºè®®å¿…é¡»æœ‰æ•°æ®æ”¯æ’‘ï¼Œå¼•ç”¨JSONæ•°æ®ä¸­çš„å…·ä½“æ•°å­—æˆ–äº‹å®
        - ç¡®ä¿æ‰€æœ‰å»ºè®®éƒ½æ¥è‡ªæä¾›çš„æ•°æ®ï¼Œä¸è¦ç¼–é€ 
        
        è¯·ç›´æ¥è¿”å›åŸå§‹HTMLä»£ç ï¼Œä¸è¦ä½¿ç”¨Markdownæ ¼å¼ï¼ˆå¦‚```htmlï¼‰ï¼Œä¸è¦ä½¿ç”¨ä»»ä½•ä»£ç å—æ ‡è®°ã€‚åªè¾“å‡ºHTMLä»£ç ï¼Œä¸è¦åŒ…å«<html>ã€<head>æˆ–<body>æ ‡ç­¾ã€‚
        """
        
        # å°† prompt åŒ…è£…æˆæ­£ç¡®çš„ messages æ ¼å¼
        llm_messages = [{"role": "user", "content": prompt}]
        # ä¼ é€’åŒ…è£…å¥½çš„ llm_messages åˆ—è¡¨ç»™ messages å‚æ•°
        return self.llm.generate(messages=llm_messages)
    
    def generate_ip_distribution_analysis(self, ip_distribution_data: Dict) -> str:
        """ç”Ÿæˆç”¨æˆ·åœ°ç†åˆ†å¸ƒåˆ†ææ¨¡å—
        
        Args:
            ip_distribution_data: ç”¨æˆ·åœ°ç†åˆ†å¸ƒåˆ†ææ•°æ®
            
        Returns:
            str: ç”¨æˆ·åœ°ç†åˆ†å¸ƒåˆ†æHTMLå†…å®¹
        """
        prompt = f"""
        è¯·æ ¹æ®ä»¥ä¸‹æ•°æ®ï¼Œç”Ÿæˆç”¨æˆ·åœ°ç†åˆ†å¸ƒåˆ†ææ¨¡å—çš„HTMLå†…å®¹ï¼š
        
        ```json
        {json.dumps(ip_distribution_data, ensure_ascii=False, indent=2)}
        ```
        
        è¯·éµå¾ªä»¥ä¸‹è®¾è®¡è§„èŒƒï¼š
        1. æ¨¡å—å¸ƒå±€:
        ```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ç”¨æˆ·åœ°ç†åˆ†å¸ƒåˆ†æ                           ğŸ”„ åˆ‡æ¢è§†å›¾    â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                                         â”‚
        â”‚ ã€æ ¸å¿ƒæ´å¯Ÿã€‘ã€åœ°åŒºåã€‘çš„ç”¨æˆ·äº’åŠ¨çƒ­åº¦æœ€é«˜ï¼Œçƒ­åº¦å€¼è¾¾åˆ°    â”‚
        â”‚ ã€æ•°å€¼ã€‘ï¼Œå æ€»çƒ­åº¦çš„ã€ç™¾åˆ†æ¯”ã€‘                          â”‚
        â”‚                                                         â”‚
        â”‚ â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®  â”‚
        â”‚ â”‚                                                   â”‚  â”‚
        â”‚ â”‚              [åœ°åŒºçƒ­åº¦æŸ±çŠ¶å›¾]                     â”‚  â”‚
        â”‚ â”‚                                                   â”‚  â”‚
        â”‚ â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯  â”‚
        â”‚                                                         â”‚
        â”‚ ã€åœ°åŒºåˆ†å¸ƒæ˜ç»†ã€‘                                        â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
        â”‚ â”‚ åœ°åŒº     â”‚ çƒ­åº¦å€¼    â”‚ çƒ­åº¦å æ¯” â”‚                      â”‚
        â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
        â”‚ â”‚ åœ°åŒº1    â”‚ XXXXX     â”‚ XX.X%  â”‚                      â”‚
        â”‚ â”‚ åœ°åŒº2    â”‚ XXXXX     â”‚ XX.X%  â”‚                      â”‚
        â”‚ â”‚ åœ°åŒº3    â”‚ XXXXX     â”‚ XX.X%  â”‚                      â”‚
        â”‚ â”‚ åœ°åŒº4    â”‚ XXXXX     â”‚ XX.X%  â”‚                      â”‚
        â”‚ â”‚ åœ°åŒº5    â”‚ XXXXX     â”‚ XX.X%  â”‚                      â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
        â”‚                                                         â”‚
        â”‚ ã€å“ç‰Œåœ°åŒºåˆ†å¸ƒã€‘                                        â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ å“ç‰Œ     â”‚ çƒ­é—¨åœ°åŒº1  â”‚ çƒ­é—¨åœ°åŒº2  â”‚ çƒ­é—¨åœ°åŒº3      â”‚
        â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
        â”‚ â”‚ å“ç‰ŒA    â”‚ XX%        â”‚ XX%        â”‚ XX%            â”‚
        â”‚ â”‚ å“ç‰ŒB    â”‚ XX%        â”‚ XX%        â”‚ XX%            â”‚
        â”‚ â”‚ å“ç‰ŒC    â”‚ XX%        â”‚ XX%        â”‚ XX%            â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                                         â”‚
        â”‚ ã€ç”¨æˆ·åŸå£°ã€‘                                            â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ "ã€åŸæ–‡å¼•ç”¨1ã€‘" - æ¥è‡ªã€å¹³å°ã€‘                       â”‚ â”‚
        â”‚ â”‚ ğŸ‘ XXk Â· ğŸ”— ç‚¹å‡»æŸ¥çœ‹åŸæ–‡                              â”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        ```
        
        2. å¯è§†åŒ–è¦æ±‚:
        - ä½¿ç”¨ECharts.jsåˆ›å»ºåœ°åŒºçƒ­åº¦æŸ±çŠ¶å›¾
        - æ¨ªè½´ä¸ºåœ°åŒºåç§°ï¼Œçºµè½´ä¸ºçƒ­åº¦å€¼
        - ä½¿ç”¨æ¸å˜è‰²æ˜¾ç¤ºçƒ­åº¦å·®å¼‚
        - ç¡®ä¿å›¾è¡¨äº¤äº’æ€§(æ‚¬åœæ˜¾ç¤ºçƒ­åº¦å€¼å’Œå æ¯”)
        
        3. å†…å®¹è¦æ±‚:
        - æ ¸å¿ƒæ´å¯Ÿéƒ¨åˆ†åªå…³æ³¨åœ°åŒºçƒ­åº¦åˆ†å¸ƒï¼Œæç‚¼æœ€é«˜çƒ­åº¦çš„åœ°åŒº
        - ç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½æ¥è‡ªæä¾›çš„JSON
        
        è¯·ç”Ÿæˆå®Œæ•´çš„HTMLä»£ç ç‰‡æ®µï¼ŒåŒ…å«å¿…è¦çš„CSSæ ·å¼å’ŒECharts.jsçš„å›¾è¡¨é…ç½®ã€‚ä¸è¦åŒ…å«<html>ã€<head>æˆ–<body>æ ‡ç­¾ã€‚
        """
        
        return self._generate_with_stream(prompt)
    
    def get_css_styles(self) -> str:
        """è·å–CSSæ ·å¼
        
        Returns:
            str: CSSæ ·å¼ä»£ç 
        """
        return """
        /* å…¨å±€æ ·å¼ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
        }
        
        body {
            background-color: #f9f9f9;
            color: #333333;
        }
        
        .report-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
            background-color: #ffffff;
            box-shadow: 0 2px 16px rgba(0, 0, 0, 0.05);
        }
        
        .report-header {
            text-align: center;
            margin-bottom: 32px;
            padding-bottom: 16px;
            border-bottom: 1px solid #EEEEEE;
        }
        
        .report-header h1 {
            font-size: 28px;
            font-weight: bold;
            color: #333333;
            margin-bottom: 8px;
        }
        
        .report-date {
            font-size: 14px;
            color: #999999;
        }
        
        /* æ¨¡å—é€šç”¨æ ·å¼ */
        .module {
            margin-bottom: 32px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            background-color: #ffffff;
        }
        
        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background-color: #3366FF;
            color: white;
        }
        
        .module-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .module-actions {
            display: flex;
            gap: 8px;
        }
        
        .module-content {
            padding: 24px;
        }
        
        .insight {
            margin-bottom: 24px;
            line-height: 1.6;
        }
        
        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            width: 100%;
            height: 400px;
            margin: 24px 0;
            border-radius: 8px;
            overflow: hidden;
            background-color: #FCFCFC;
            border: 1px solid #EEEEEE;
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 24px 0;
        }
        
        .data-table th,
        .data-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #EEEEEE;
        }
        
        .data-table th {
            font-weight: bold;
            background-color: #F7F7F7;
        }
        
        .data-table tr:hover {
            background-color: #F5F9FF;
        }
        
        /* ç”¨æˆ·åŸå£°æ ·å¼ */
        .quotes-container {
            margin-top: 24px;
        }
        
        .quote-card {
            padding: 16px;
            margin-bottom: 16px;
            background-color: #F9F9F9;
            border-radius: 8px;
            border-left: 4px solid #3366FF;
        }
        
        .quote-content {
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 8px;
        }
        
        .quote-meta {
            font-size: 12px;
            color: #999999;
            display: flex;
            justify-content: space-between;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1199px) {
            .report-container {
                padding: 16px;
            }
            
            .chart-container {
                height: 300px;
            }
        }
        
        @media (max-width: 767px) {
            .module-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .chart-container {
                height: 250px;
            }
            
            .data-table {
                font-size: 12px;
            }
            
            .data-table th,
            .data-table td {
                padding: 8px;
            }
        }
        
        /* å“ç‰Œä¼˜åŒ–å»ºè®®æ ·å¼ */
        .suggestion-card {
            padding: 16px;
            margin-bottom: 16px;
            border-radius: 8px;
            border: 1px solid #EEEEEE;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .suggestion-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #3366FF;
        }
        
        .suggestion-content {
            margin-bottom: 12px;
        }
        
        .suggestion-list {
            padding-left: 24px;
            margin-bottom: 12px;
        }
        
        .suggestion-data {
            font-size: 12px;
            padding: 8px;
            background-color: #F5F9FF;
            border-radius: 4px;
        }
        
        /* é¡µè„šæ ·å¼ */
        .report-footer {
            margin-top: 48px;
            padding-top: 16px;
            border-top: 1px solid #EEEEEE;
            text-align: center;
            font-size: 12px;
            color: #999999;
        }
        """

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # åˆ›å»ºæŠ¥å‘Šç”Ÿæˆå™¨
    generator = ReportLLMGenerator()
    
    # è®¾ç½®æ•°æ®ç›®å½•å’Œè¾“å‡ºç›®å½•
    generator.set_data_dir("outputs/v0.2.1_å¸®æˆ‘åšä¸€ä¸‹å°ç±³æ±½è½¦çš„ç«å“åˆ†æ/data")
    generator.set_output_dir("outputs/report_test")
    
    # è®¾ç½®æŠ¥å‘Šåç§°
    generator.set_report_name("ç”¨æˆ·queryåˆ†ææŠ¥å‘Š")
    
    # ç”ŸæˆæŠ¥å‘Š
    report_path = generator.generate_report()
    
    print(f"æŠ¥å‘Šå·²ç”Ÿæˆ: {report_path}")
